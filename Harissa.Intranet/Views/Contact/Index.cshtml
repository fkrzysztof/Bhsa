@model Harissa.Data.Data.Contact
@using Harissa.Data.Data
@await Html.PartialAsync("TopNavi")

@*List*@
<div class="row" id="contactList">
    @foreach (var item in ViewBag.ContactList as List<Contact> )
    {

        <div class="col-sm-6 mt-2">
            <div class="card toHide">
                <div class="card-body">
                    <div class="row">
                        <div class="col-8 text-left">
                            <h5 class="card-title">@item.Name</h5>
                        </div>
                        <div class="col-4 text-right">
                            <a asp-action="Deletesocial" class="removeButton" data-id="@item.ContactID"><i class="fas fa-trash" style="font-size: 1rem; color:black;"></i></a>
                            <a href="#" class="editButton" data-id="@item.ContactID" data-email="@item.Email" data-name="@item.Name" data-phone="@item.Phone"><i class="fas fa-tools" style="font-size: 1rem; color:black;"></i></a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <p class="card-text">@item.Email</p>
                            <p class="card-text">@item.Phone</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>
<hr />
@*Create*@
<div class="row">
    <div class="col-md-6">
        <div class="card toHide shadow">
            <div class="card-header bg-white"><h5 class="align-items-center"><i class="bi bi-plus-circle m-2" style="font-size: 1.5rem; color:black;"></i>Create Contact</h5></div>
            <div class="card-body">
                <form asp-action="Create" id="formCreate">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <div class="form-group">
                        <label asp-for="@Model.Email" class="control-label"></label>
                        <input asp-for="@Model.Email" class="form-control" />
                        <span asp-validation-for="@Model.Email" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="@Model.Phone" class="control-label"></label>
                        <input asp-for="@Model.Phone" class="form-control" />
                        <span asp-validation-for="@Model.Phone" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="@Model.Name" class="control-label"></label>
                        <input asp-for="@Model.Name" class="form-control" />
                        <span asp-validation-for="@Model.Name" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <input type="submit" value="Create" class="btn btn-primary" />
                        <input type="reset" value="Reset" class="btn btn-primary" />
                    </div>
                </form>
            </div>
        </div>
    </div>
@*Edit*@
    <div class="col-md-6 disabledElement editContact" style="opacity:0.2;">
        <div class="card shadow">
            <div class="card-header bg-white"><h5><i class="fas fa-tools m-2" style="font-size: 1.5rem; color:black;"></i>Edit Contact</h5></div>
            <div class="card-body">
                <form asp-action="Edit" id="formEdit">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <input type="hidden" asp-for="ContactID" class="idEdit"/>
                    <div class="form-group">
                        <label asp-for="Email" class="control-label"></label>
                        <input asp-for="Email" class="form-control emailEdit" />
                        <span asp-validation-for="Email" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Phone" class="control-label"></label>
                        <input asp-for="Phone" class="form-control phoneEdit" />
                        <span asp-validation-for="Phone" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Name" class="control-label"></label>
                        <input asp-for="Name" class="form-control nameEdit" />
                        <span asp-validation-for="Name" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <input type="submit" id="sendForm" value="Save" class="btn btn-primary" />
                        <input id="cancelEdit" type="reset" value="Anuluj" class="btn btn-primary"/>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>

    $(document).ready(function () { 

        //Delete
        $("body").on("click", ".removeButton", function (event) {
            event.preventDefault();
            let send = $(this).data("id");
            $.post("/Contact/RemoveJS", { id: send }, function (data) {
                if (data == true) {
                    contactList();
                }
                else {
                    alert("Wystąpił problem..");
                }
            });
        });

        //Start edit
        $("body").on("click", ".editButton" , function (event) {
            event.preventDefault();
            let dataFormButton = $(this);
            let toHide = $(".toHide");
            toHide.addClass("disabledElement").animate({ opacity: 0.2 }, 600);

            $(".editContact").animate({ opacity: 1 }, 600, function () {
                $(".idEdit").attr("value", dataFormButton.data("id"));
                $(".emailEdit").attr("value", dataFormButton.data("email"));
                $(".nameEdit").attr("value", dataFormButton.data("name"));
                $(".phoneEdit").attr("value", dataFormButton.data("phone"));

            }).removeClass("disabledElement");
        });

        
        function editOut() {
            $(".editContact").animate({ opacity: 0.2 }, 600, function () {
                $(".toHide").animate({ opacity: 1 }, 600).removeClass("disabledElement");
                $(this).addClass("disabledElement");
            });
            editReset()
        }

        //Show list
        function contactList() {
            $.getJSON("/Contact/ListJS", function (data) {
                let htmlToFor = "";
                for (var i = 0; i < data.length; i++) {

                    htmlToFor += "" +
                        "<div class=\"col-sm-6  mt-2\">" +
                        "<div class=\"card toHide\">" +
                        "<div class=\"card-body\">" +
                        "<div class=\"row\">" +
                        "<div class=\"col-8 text-left\">" +
                        "<h5 class=\"card-title\">" + data[i].name + "</h5>" +
                        "</div>" +
                        "<div class=\"col-4 text-right\">" +
                        "<a href=\"Contact/DeleteSocialMedias\" class=\"removeButton\" data-id=\"" + data[i].contactID + "\"><i class=\"fas fa-trash mr-1\" style=\"font-size: 1rem; color:black;\"></i></a>" +
                        "<a href=\"#\" class=\"editButton\" data-id=\"" + data[i].contactID + "\" data-email=\"" + data[i].email + "\" data-name=\"" + data[i].name + "\" data-phone=\"" + data[i].phone + "\"><i class=\"fas fa-tools\" style=\"font-size: 1rem; color:black;\"></i></a>" +
                        "</div>" +
                        "</div>" +
                        "<div class=\"row\">" +
                        "<div class=\"col-12\">" +
                        "<p class=\"card-text\">" + data[i].email + "</p>" +
                        "<p class=\"card-text\">" + data[i].phone + "</p>" +
                        "</div>" +
                        "</div>" +
                        "</div>" +
                        "</div>" +
                        "</div>";

                }
                $("#contactList").html(htmlToFor);
            });
        }

        function createReset() {
            $("#formCreate")[0].reset();
        }

        function editReset() {
            $(".idEdit").attr("value", "");
            $(".emailEdit").attr("value","");
            $(".nameEdit").attr("value", "");
            $(".phoneEdit").attr("value", "");
        }

        $("#cancelEdit").click(function (event) {
            //event.preventDefault();
            editOut();
        });

        //Edit
        $("#formEdit").submit(function (e) {
            e.preventDefault();
            if ($(".field-validation-error").length != 0)
                return;

            var formValues = $(this).serialize();
            $.post("/Contact/EditJS", formValues, function (data) {
                if (data == true) {
                    editOut();
                    contactList();
                }
                else {
                    alert("Wystąpił problem..");
                }
            });
        });

        //Create
        $("#formCreate").submit(function (e) {
            e.preventDefault();
            if ($(".field-validation-error").length != 0)
                return;

                var formValues = $(this).serialize();
                $.post("/Contact/CreateJS", formValues, function (data) {
                    if (data == true) {
                        createReset();
                        contactList();
                    }
                    else {
                        alert("Wystąpił problem..");
                    }
                });
        });

    });
</script>




