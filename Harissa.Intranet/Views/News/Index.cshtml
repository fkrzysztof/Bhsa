@model IEnumerable<Harissa.Data.Data.News>
@using Harissa.Data.HelperClass
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@await Html.PartialAsync("TopNavi")


<div class="row">
    @{
        int index;
     }
    @foreach (var item in Model)
    {
        index = 0;
        <div class="card m-4 shadow-sm">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        @{
                            string getimg = new CloudAccess().GetImg(item.MediaItem);
                        }
                        <img src="@getimg" class="img-fluid rounded" />
                    </div>
                    <div class="col-md-8">
                        <small>@item.DateOfPublication</small>
                        <h5 class="card-title">@Html.DisplayFor(modelItem => item.Title)</h5>
                        <hr />
                        <p class="card-text">@Html.DisplayFor(modelItem => item.Message)</p>
                        <div class="row">
                            @foreach (var newsMediaItem in item.NewsMediaCollections)
                            {
                                <div class="col-6 col-lg-4 d-flex justify-content-center" style="max-height:120px;">
                                    <div class="img-thumbnail m-2 d-flex justify-content-center">
                                        <img src="@(new CloudAccess().GetImg(newsMediaItem.MediaItem))" data-news="@item.NewsID" data-index="@(index++)" class="h-100 showBotton" />
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                    <div class="col-md-1 mt-md-0 mt-4 text-center">
                        <a asp-action="Edit" asp-route-id="@item.NewsID"><i class="fas fa-tools m-md-2 m-5" style="font-size: 1.5rem; color:black;"></i></a>
                        <a asp-action="Delete" asp-route-id="@item.NewsID"><i class="fas fa-trash m-md-2 m-5" style="font-size: 1.5rem; color:black;"></i></a>
                    </div>
                </div>
            </div>
        </div>
    }
</div>


<script src="https://product-gallery.cloudinary.com/all.js" type="text/javascript">
</script>


<!-- The Modal -->
<div class="modal" id="modalDiv" style="background-color:black;">
    <div class="container">
        <div class="row">
            <div class="col-6 text-left">
                <a href="#" id="next">--></a>
            </div>
            <div class="col-6 text-right">
                <a href="#" id="closeBotton"><i class="fas fa-times" style="font-size:3rem; color:white;"></i></a>
            </div>
            <div class="col-12 text-center">
                <div id="my-gallery" style="max-width:80%;margin:auto">
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {

        let x;

        $(".showBotton").on("mouseover", function () {
            $(this).css('cursor', 'pointer');
        });

        $(".showBotton").on("click", function (e) {
            //e.preventDefault();
            //let news = $(this).attr("news");
            let news = $(this).data("news");
            let index = $(this).data("index");
            console.log("to jest:" + news);
            console.log("to jest index:" + index);
            let dataColl;
            $.getJSON("/News/ImgToModalNews", { id: news }, function (data) {
                dataColl = data;
                const myGallery = cloudinary.galleryWidget({
                    container: "#my-gallery",
                    cloudName: "harissa",
                    startIndex: index,
                    mediaAssets: dataColl
                });
                myGallery.render();
                x = myGallery;
                $("#modalDiv").fadeIn();
            });

            $("#closeBotton").on("click", function () {
                $("#modalDiv").fadeOut();
                x.destroy();
            });
        });
    });
</script>





